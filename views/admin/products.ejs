<div class="modal fade" id="parent-product-modal" tabindex="-1" role="dialog" aria-labelledby="parent-product-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Entrez un ID produit ou recherchez dans la base de données (ce champ peut rester vierge)</h4>
            </div>
            <div class="modal-body">                
                <div class="alert" hidden></div>
                <div class="form-group row">
                    <label class="sr-only" for="parent-product-id">ID Produit</label>
                    <input type="text" class="form-control form-control-success form-control-danger col-md-6 offset-md-3" id="parent-product-id" name="parent-product-id" placeholder="ID Produit" autocomplete="off">
                </div>
                <div class="form-group row">
                    <div class="col-md-6 offset-md-3">
                        <button type="button" id="add-parent-product" class="btn btn-primary">Valider</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<section id="admin-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Management des produits</h1>
                <form>
                    <fieldset>
                        <legend>
                            <button id="add-product-legend" data-toggle="collapse" data-target="#form-toggle">Ajouter un produit</button>
                        </legend>
                        <div id="form-toggle" class="collapse">
                            <div class="form-group">
                                <label for="brand_id">Marque</label>
                                <select class="form-control" id="brand_id" name="brand_id" data-field-name="brand">
                                    <option value="0">Choisir une marque</option>
                                    <%_ brands.forEach(function(brand){ _%>
                                    <option value="<%= brand.id _%>"><%= brand.name _%></option>
                                    <%_ }); _%>
                                </select>
                                <input name="brand_name" type="hidden" />
                            </div>
                            <div class="form-group">
                                <label for="name">Nom</label>
                                <input class="form-control" type="text" id="name" name="name" />
                            </div>
                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea class="form-control" id="description" name="description"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="categories">Catégories</label>
                                <select id="categories" name="categories"></select>
                            </div>
                            <div class="form-group">
                                <label for="picture_url">Image</label>
                                <input class="form-control" type="text" placeholder="url" id="picture_url" name="picture_url" />
                                <input class="form-control" type="text" placeholder="alt" name="picture_alt" />
                                <input class="form-control" type="text" placeholder="title" name="picture_title" />
                            </div>
                            <div class="form-group">
                                <label for="commercial_url">Url commerciale</label>
                                <input class="form-control" type="text" id="commercial_url" name="commercial_url" />
                            </div>
                            <div class="form-group">
                                <label for="price">Prix</label>
                                <input class="form-control" type="text" id="price" name="price" />
                            </div>
                            <div class="form-group">
                                <label>Produit parent</label>
                                <button class="open-parent-product-modal btn btn-default" data-toggle="modal" data-target="#parent-product-modal" type="button">Choisir un produit</button>
                                <input id="add-parent-product-id" name="parent_product_id" type="hidden" />
                            </div>
                            <button class="add-button btn btn-default" type="button">Ajouter</button>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <form>
                    <table class="table table-striped table-hover table-sm">
                        <thead class="thead-inverse">
                            <tr>
                                <th>Actions</th>
                                <th>#</th>
                                <th>Marque</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Catégories</th>
                                <th>Image</th>
                                <th>Lien Comm.</th>
                                <th>Prix</th>
                                <th>Parent</th>
                                <th>Similaires</th>
                                <th>Créé</th>
                                <th>MAJ</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <%_
                            products.forEach(function(product){
                            _%>
                            <tr>
                                <td>
                                    <button type="button" class="edit-button" data-target="produits"><i class="fa fa-pencil" aria-hidden="true"></i></button>
                                    <button type="button" class="delete-button" data-target="produits"><i class="fa fa-times" aria-hidden="true"></i></button>
                                    <button type="button" class="save-button" data-target="produits"><i class="fa fa-floppy-o" aria-hidden="true"></i></button>
                                </td>
                                <td>
                                    <div>
                                        <%= product.id _%><input name="id" type="hidden" value="<%= product.id _%>" />
                                    </div>
                                </td>
                                <td>
                                    <div class="display-field"><%= product.brand.name _%></div>
                                    <div class="edit-field">
                                        <select name="brand_id" data-field-name="brand">
                                            <option value="0">Choisir une marque</option>
                                            <%_ brands.forEach(function(brand){ _%>
                                            <option value="<%= brand.id _%>"<%= product.brand.id === brand.id ? ' selected' : ''_%>><%= brand.name _%></option>
                                            <%_ }); _%>
                                        </select>
                                        <input name="brand_name" type="hidden" />
                                    </div>
                                </td>
                                <td>
                                    <div class="display-field"><%= product.name _%></div>
                                    <div class="edit-field"><input type="text" name="name" value="<%= product.name _%>" /></div>
                                </td>
                                <td>
                                    <div class="display-field"><%- product.description.length > 200 ? product.description.substring(0, 200) + '<span>&hellip;</span>' : product.description _%></div>
                                    <div class="edit-field"><textarea name="description"><%= product.description _%></textarea></div>
                                </td>
                                <td>
                                    <div class="display-field">
                                        <ul>
                                            <%_ product.categories.forEach(function(category){ _%>
                                            <li><%= category.name _%></li>
                                            <%_ }); _%>
                                        </ul>
                                    </div>
                                    <div class="edit-field">
                                        <select name="categories">
                                            <%_ product.categories.forEach(function(category){ _%>
                                            <option selected value="<%= category.id _%>"><%= category.name _%></option>
                                            <%_ }); _%>
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <div class="display-field"><img src="<%= product.picture_url.replace(/-original/g, '-thumbnail') _%>" alt="<%= product.picture_alt _%>" title="<%= product.picture_title _%>" /></div>
                                    <div class="edit-field">
                                        <input type="text" placeholder="url" name="picture_url" value="<%= product.picture_url _%>" />
                                        <input type="text" placeholder="alt" name="picture_alt" value="<%= product.picture_alt _%>" />
                                        <input type="text" placeholder="title" name="picture_title" value="<%= product.picture_title _%>" />
                                    </div>
                                </td>
                                <td>
                                    <div class="display-field break-url"><%= product.commercial_url _%></div>
                                    <div class="edit-field"><input type="text" name="commercial_url" value="<%= product.commercial_url _%>" /></div>
                                </td>
                                <td>
                                    <div class="display-field"><%= product.price _%></div>
                                    <div class="edit-field"><input type="text" name="price" value="<%= product.price _%>" /></div>
                                </td>                                
                                <td>                                    
                                    <%_ if(product.parent_product_id !== null){ _%>
                                    <div class="display-field"><%= product.parentProduct.brand.name + ' ' + product.parentProduct.name _%></div>
                                    <%_ } _%>
                                    <div class="edit-field">
                                        <button type="button" class="open-parent-product-modal btn btn-default" data-toggle="modal" data-target="#parent-product-modal">Choisir un produit</button>
                                        <input id="add-parent-product-id" name="parent_product_id" type="hidden" <%= product.parent_product_id !== null ? product.parent_product_id : '' _%> />
                                    </div>                                    
                                </td>                                                             
                                <td>
                                    <%_ if(product.similarProducts && product.similarProducts.length > 0){ _%>
                                    <ul>
                                        <%_ product.similarProducts.forEach(function(similarProduct){ _%>
                                        <li><%= similarProduct.brand.name + ' ' + similarProduct.name _%></li>
                                        <%_ }); _%>
                                    </ul>
                                    <%_ } _%>
                                </td>
                                
                                <td>
                                    <div><%= moment(product.created_at).format('DD-MMMM-YYYY') _%></div>                                    
                                </td>
                                <td>
                                    <div><%= product.updated_at ? moment(product.updated_at).format('DD-MMMM-YYYY') : 'No updates' _%></div>                                    
                                </td>
                                <td>
                                    <button type="button" class="edit-button" data-target="produits"><i class="fa fa-pencil" aria-hidden="true"></i></button>
                                    <button type="button" class="delete-button" data-target="produits"><i class="fa fa-times" aria-hidden="true"></i></button>
                                    <button type="button" class="save-button" data-target="produits"><i class="fa fa-floppy-o" aria-hidden="true"></i></button>
                                </td>
                            </tr>
                            <%_
                            });
                            _%>
                        </tbody>
                    </table>
                </form>
                <div class="progress">
                    <div class="progress-bar" role="progressbar"></div>
                </div>
                <button class="upload-button">upload</button>
                <input type="file" id="file-upload" style="display: none;" name="file-upload" />
            </div>
        </div>
        <%- include('../partials/pagination', { pagination:  pagination }) %>
    </div>
</section>
<%- contentFor('bodyClass') %>
class="admin"
<%- contentFor('extraScripts') %>
<script type="text/javascript" src="/js/common.js"></script>
<script type="text/javascript" src="/js/mainAdmin.js"></script>